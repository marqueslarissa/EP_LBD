/* VIEW - OTIMIZACAO
* Esta visao servira para otimizar uma consulta que gera um relatorio retornando uma listagem de funcionarios da empresa no sistema,
* bem como suas informacoes. Por conta disso, tem a necessidade de realizar juncoes para que seja possivel retornar um relatorio mais completo
* possivel com as informacoes presentes no nosso modelo. */

CREATE VIEW relatorio_otimizado as (
	SELECT E.name_employee, E.date_admission, E.salary,L.name_knowledge, D.name_dependent, DEP.name_department, t.name_team, P.name_project
	FROM employee AS E
	LEFT JOIN level_knowledge AS L ON L.idt_knowledge = E.idt_level_knowledge
	LEFT JOIN (SELECT name_dependent , idt_employee
				FROM dependent ) AS D on d.idt_employee = e.idt_employee
	LEFT JOIN department AS DEP on dep.idt_department = e.idt_department 
	LEFT JOIN team as T on T.idt_team = e.idt_team 
	LEFT JOIN (SELECT name_project , idt_project 
				FROM project ) AS P on p.idt_project = t.idt_project 
	ORDER BY 1,5
 ); 
 
/* CONSULTAS UTILIZANDO ESTA VIEW */

/* Seleciona o nome do empregado e seus respectivos dependentes presentes no relatorio_otimizado. */
SELECT name_employee, name_dependent
FROM relatorio_otimizado

/* Seleciona o nome do time e a media salarial deste mesmo time presentes no relatorio_otimizado. */
SELECT name_team, AVG(salary)
FROM relatorio_otimizado
GROUP BY name_team

/* DISCUSSAO SOBRE A RELACAO CUSTO/BENEFICIO 

/*	Por ser uma query utilizada principalmente para gerar relatorios periodicos da empresa, esta torna-se entao muito "acessada", pois retorna
* todas as informacoes de um funcionario se encontra atualmente na empresa apenas fazendo um select na view e requisitando as informacoes desejadas
* ja que nela ja esta presente todas as juncoes presentes (ou, poss√≠veis) no modelo. Tambem eh possivel notar que ocultamos dados sensiveis como o salario 
* e o identificador do funcionario evitando assim realizar uma rastreabilidade na base com as informacoes. 
* Nesse caso por conter as informacoes mais utilizadas do modelo esta view torna-se muito util na realizacao de updates pois alterar todas os dados 
* relacionados a um empregado presente no sistema. */




